<div id="alerts"></div>
<h1>Youtube Extractor</h1>
<p>Bitte die URL für den zu extrahierenden Song und die Formattierung des Titels in der folgenden Form angeben:</p>
<form class="form-horizontal">
	<div class="form-group">
		<label for="url" class="col-sm-2 control-label">URL</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon1">http://</span>
				<input type="text" class="form-control" placeholder="https://www.youtube.com/watch?v=lOL_LUwRn7U" id="url">
			</div>
		</div>
	</div>
	<div class="form-group">
		<label for="format" class="col-sm-2 control-label">Titel Format</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon1">Format</span>
				<input type="text" class="form-control" value="%(artist)s - %(title)s" id="format">
			</div>
		</div>
	</div>
	<div class="form-group">
		<div class="col-sm-offset-2 col-sm-10">
			<button class="btn btn-default" type="button" id="go">Extract!</button>
			</div>
	</div>
</form>
<script type="text/html" id="alert-upload-failed">
	<div class="alert alert-danger alert-dismissible" role="alert">
		<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
		<strong>Fehler!</strong> Sie verfügen nicht über die nötige Berechtigung, Musik hochzuladen.
	</div>
</script>
<script>
	function downloadFinished(response) {
	}

	function addElem(link) {
		var elem = $("<tr><td>" + link + "</td><td><i class=\"fa fa-cog fa-spin\"></i></td><td></td><td></td></tr>").appendTo("#vids");
		return elem;
	}

	function startDownload(url, format) {
		var link = "<a href=\""+ url + "\">" + url + "</a>"
		var elem = addElem(link);
		$.getJSON("/api/music/youtube?url=" + encodeURI(url) + "&format=" + encodeURI(format), function(response) {
			downloadFinished(response);
			if(response.okay) {
				elem.html("<td>" + link + "</td><td><i class=\"fa fa-check\"></i></td><td>" + response.artist + "</td><td>" + response.title + "</td>");
			}
			else {
				if(response.reason == "insufficient_permission") {
					$($("#alert-upload-failed").html()).appendTo('#alerts');
				}
				elem.html("<td>" + link + "</td><td><i class=\"fa fa-remove\"></i></td><td></td><td></td>");
			}
		});
	}

	$("#go").click(function() {
		var url = $("#url").val();
		var format = $("#format").val();
		startDownload(url, format);
	});
</script>
<h2>Results</h2>
<table class="table table-striped">
	<thead>
		<tr>
			<th>URL</th>
			<th>Status</th>
			<th>Artist</th>
			<th>Title</th>
		</tr>
	</thead>
	<tbody id="vids">
	</tbody>
</table>

<h2>Erklärung</h2>
<p>Es muss die URL zum Video das den gewünschten Song enthält hier eingegeben werden und der Bot wird automatisch die Audio-Spur des Videos extrahieren und zur Datenbank von bekannten Songs hinzufügen.
	Es muss ein Format angegeben werden, in dem der Titel des Videos formattiert ist, sodass der Interpret und Titel des Songs abgerufen werden können.</p>
<table class="table table-striped">
	<thead>
		<tr>
			<th>Ausdruck</th>
			<th>Bedeutung</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>%(artist)s</td>
			<td>Name des Interpreten</td>
		</tr>
		<tr>
			<td>%(title)s</td>
			<td>Titel des Songs</td>
		</tr>
		<tr>
			<td>%(album)s</td>
			<td>Name des Albums</td>
		</tr>
	</tbody>
</table>
<p>Beispiel: <code>%(artist)s - %(title)s</code></p>
