<h1>Einstellungen</h1>
<p>Hier können benutzerdefinierte Einstellungen verändert werden.</p>
<h2>Generelle Einstellungen</h2>
<form class="form-horizontal" id="settings-form">
	<div class="form-group">
		<label for="record" class="col-sm-2 control-label">Aufnahme</label>
		<div class="col-sm-10">
			<div class="input-group">
				<span class="input-group-addon" id="basic-addon1"><i class="fa fa-microphone"></i></span>
				<select class="form-control" name="record" id="record" required>
					<option value="false" {{#unless user.settings.record}}selected{{/unless}}>Nein</option>
					<option value="true" {{#if user.settings.record}}selected{{/if}}>Ja</option>
				</select>
			</div>
		</div>
	</div>
	<div class="form-group">
		<label for="save" class="col-sm-2 control-label">Speichern</label>
		<div class="col-sm-10">
			<button class="btn btn-default" type="button" id="submit"><i class="fa fa-save"></i> Speichern</button>
		</div>
	</div>
</form>
<script>
	$('#submit').click(function() {
		var record = encodeURI($('#record').val());
		$.ajax("/api/users/settings" +
			"?record=" + record)
		.done(function(res) {
			spawnNotification('success', "Einstellungen erfolgreich gespeichert.");
		})
		.error(function() {
			spawnNotification('error', "Beim Speichern der Einstellungen ist ein Fehler aufgetreten.");
		});
	});
</script>

<h2>Gelinkte Mumble-Benutzer</h2>
<p>Bitte weisen Sie Benutzer im Mumble-Server ihrem Account an diesem Bot zu.
	Auf diese Weise können Sie Features wie Aufnahme oder besondere Rechte wahrnehmen,
	da der Bot den Mumble-Benutzer den Datenbankbenutzern zuordnen kann.</p>
<ul id="linked-mumble-users" class="list-group">
	{{#each linkedUsers}}
	<li class="list-group-item">{{this.name}} ({{this.id}})</li>
	{{/each}}
</ul>
<div class="dropdown">
<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
	Mumble User Linken
	<span class="caret"></span>
</button>
<ul class="dropdown-menu">
	{{#each freeMumbleUsers}}
	<li><a mumbleId="{{this.id}}" class="link-mumble">{{this.name}} ({{this.id}})</a></li>
	{{/each}}
</ul>
</div>
<script>
	$(".link-mumble").click(function() {
		var id = $(this).attr('mumbleId');
		$.ajax("/api/users/linkMumbleUser?id=" + id + "&username={{user.username}}")
		.done(function(res) {
			if(res.okay) {
				$("<li class='list-group-item'>" + id + "</li>").appendTo("#linked-mumble-users");
				spawnNotification('success', "Link wurde erfolgreich erstellt.");
				$(this).parent().remove();
			}
			else {
				spawnNotification('error', "Link konnte nicht erstellt werden.");
			}
		}.bind(this));
	});
</script>
